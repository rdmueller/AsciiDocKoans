<html>
<head>
    <script src="asciidoctor/browser/asciidoctor.js"></script>
    <link rel="stylesheet" href="asciidoctor/css/asciidoctor.css"></link>
    <style>
        div#myTarget {
            border: 1px solid #888888;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        div#myTarget:before {
            content: 'target';
            font-family: arial, sans-serif;
            background-color: white;
            position: relative;
            top: -18px;
            padding: 3px 6px;
            width: 30px;
        }
        div#input {
            border: 2px solid #888888;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        div#input:before {
            content: 'your result';
            font-family: arial, sans-serif;
            background-color: white;
            position: relative;
            top: -18px;
            padding: 3px 6px;
            width: 30px;
        }
        div#input.correct:before {
            content: 'correct';
            font-family: arial, sans-serif;
            font-weight: bold;
            background-color: white;
            position: relative;
            top: -18px;
            padding: 3px 6px;
            width: 30px;
        }
        body {
            padding: 20px 20px;
            height: 100vh;
            widht: 100vw;
        }
        html{
            position: relative;
            height: 100vh;
            widht: 100vw;
        }
        #plain {
            height: 10em;
            font-family: Monospaced, monospace;
            padding: 2px 4px;
        }
        #nextDialog {

            border: 2px solid #888888;
            border-radius: 10px;
            position: fixed;
            top: 30%;
            bottom: 30%;
            left:20%;
            right: 20%;
            background-color: rgba(175, 220, 185, 0.9);
            text-align: center;
            display: none;
        }
        #nextDialog.display {
            display: block !important;
        }
        #next {
            position: absolute;
            top: 5%;
            bottom: 30%;
            left:5%;
            right: 5%;
            text-align: center;
        }
        #nextDialog button {
            border: 2px solid #888888;
            border-radius: 10px;
            position: absolute;
            bottom: 5%;
            width: 8em;
            margin-left: auto;
            margin-right: auto;
            left: 5%;
            right: 5%;
            padding: 5px 10px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
<div id="description">
loading koan...
</div>
<div id="myTarget"></div>
<div id="hint"></div>
<div id="input"></div>
<textarea id="plain" style="width: 100%;" onkeyup="convert();">
</textarea>

<div id="nextDialog"><div id="next"></div><button onclick="next();">Next</button></div>
</body>
<script>
    var koanNum = 1;
    var targetHtml = ""
    var asciidoctor = Asciidoctor();

    function init() {
        console.log("init");
        document.getElementById('plain').focus();
        targetHtml = document.getElementById('myTarget').innerHTML
    }
    function getKoan() {
        fetch("koans/koan_"+koanNum+".adoc")
            .then(function (response) {
                if (response.ok) {
                    return response.text();
                } else {
                    alert("HTTP-Error: " + response.status);
                }
            })
            .then(function (koan) {
                koan = koan.split("'''")
                var description = document.getElementById('description');
                description.innerHTML = asciidoctor.convert(":imagesdir: images\n\n" + koan[0], {to: 'html5'});
                var myTarget = document.getElementById('myTarget');
                console.log(asciidoctor.convert(koan[1], {to: 'html5'}))
                myTarget.innerHTML = asciidoctor.convert(koan[1], {to: 'html5'});
                var hint = document.getElementById('hint');
                hint.innerHTML = asciidoctor.convert(":imagesdir: images\n\n" + koan[2], {to: 'html5'});
                var plain = document.getElementById('plain');
                plain.value = koan[3];
                var next = document.getElementById('next');
                next.innerHTML = asciidoctor.convert(":imagesdir: images\n\n" + koan[4], {to: 'html5'});
                init();
                convert();
            });
    }
    function convert() {
        console.log("convert");
        var content = document.getElementById('plain').value;
        var inputHtml = asciidoctor.convert(content, {to: 'html5'});
        document.getElementById('input').innerHTML = inputHtml;
        var input = document.getElementById('input')
        if (targetHtml === inputHtml) {
            //correct
            input.style.borderColor = '#88ff88';
            input.classList.add("correct");
            document.getElementById('nextDialog').classList.add("display");
        } else {
            input.style.borderColor = '#ff8888';
            input.classList.remove("correct");
            document.getElementById('nextDialog').classList.remove("display");
        }

    };
    function next() {
        koanNum++;
        document.getElementById('nextDialog').classList.remove("display");
        getKoan();
    }
    getKoan();
</script>
</html>