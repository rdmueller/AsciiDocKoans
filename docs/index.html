<html>
<head>
    <script src="asciidoctor/browser/asciidoctor.js"></script>
    <link rel="stylesheet" href="asciidoctor/css/asciidoctor.css"></link>
    <style>
        div#myTarget {
            border: 1px solid #888888;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        div#myTarget:before {
            content: 'target';
            font-family: arial, sans-serif;
            background-color: white;
            position: relative;
            top: -18px;
            padding: 3px 6px;
            width: 30px;
        }
        div#input {
            border: 2px solid #888888;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        div#input:before {
            content: 'your result';
            font-family: arial, sans-serif;
            background-color: white;
            position: relative;
            top: -18px;
            padding: 3px 6px;
            width: 30px;
        }
        div#input.correct:before {
            content: 'correct';
            font-family: arial, sans-serif;
            font-weight: bold;
            background-color: white;
            position: relative;
            top: -18px;
            padding: 3px 6px;
            width: 30px;
        }
        body {
            padding: 20px 20px;
        }
        #plain {
            height: 10em;
            font-family: Monospaced, monospace;
            padding: 2px 4px;
        }
    </style>
</head>
<body>
<div id="description">
loading koan...
</div>
<div id="myTarget"></div>
<div id="hint"></div>
<div id="input"></div>
<textarea id="plain" style="width: 100%;" onkeyup="convert();">
</textarea>
</body>
<script>
    var targetHtml = ""
    var asciidoctor = Asciidoctor();

    function init() {
        console.log("init");
        document.getElementById('plain').focus();
        targetHtml = document.getElementById('myTarget').innerHTML
    }
    fetch("koans/koan_1.adoc")
        .then(function(response) {
            if (response.ok) {
                return response.text();
            } else {
                alert("HTTP-Error: " + response.status);
            }
        })
        .then(function(koan) {
            koan = koan.split("'''")
            var description = document.getElementById('description');
            description.innerHTML = asciidoctor.convert(":imagesdir: images\n\n"+koan[0], {to: 'html5'});
            var myTarget = document.getElementById('myTarget');
            console.log(asciidoctor.convert(koan[1], {to: 'html5'}))
            myTarget.innerHTML = asciidoctor.convert(koan[1], {to: 'html5'});
            var hint = document.getElementById('hint');
            hint.innerHTML = asciidoctor.convert(":imagesdir: images\n\n"+koan[2], {to: 'html5'});
            var plain = document.getElementById('plain');
            plain.value = koan[3];
            init();
            convert();
        });

    function convert() {
        console.log("convert");
        var content = document.getElementById('plain').value;
        var inputHtml = asciidoctor.convert(content, {to: 'html5'});
        document.getElementById('input').innerHTML = inputHtml;
        var input = document.getElementById('input')
        if (targetHtml === inputHtml) {
            //correct
            input.style.borderColor = '#88ff88';
            input.classList.add("correct");
        } else {
            input.style.borderColor = '#ff8888';
            input.classList.remove("correct");
        }


    };
    init();
    convert();
</script>
</html>